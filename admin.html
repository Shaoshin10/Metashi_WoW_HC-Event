<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clips verwalten</title>
</head>
<body>
  <h1>Clips verwalten</h1>
  <form id="adminForm">
    <label>Streamer auswählen:</label><br>
    <select name="name" id="streamerSelect" required></select><br><br>

    <label>Clip 1:</label><br><input name="clip1" id="clip1"><br>
    <label>Clip 2:</label><br><input name="clip2" id="clip2"><br>
    <label>Clip 3:</label><br><input name="clip3" id="clip3"><br><br>

    <button type="submit">Speichern</button>
  </form>

  <div id="status"></div>

  <script>
    const streamerSelect = document.getElementById('streamerSelect');

    async function loadStreamerList() {
      const res = await fetch('/data/streamer_config.json');
      const config = await res.json();

      config.forEach(streamer => {
        const opt = document.createElement('option');
        opt.value = streamer.twitchName;
        opt.textContent = streamer.twitchName;
        streamerSelect.appendChild(opt);
      });

      streamerSelect.addEventListener('change', () => {
        const selected = config.find(s => s.twitchName === streamerSelect.value);
        document.getElementById('clip1').value = selected.clips[0] || '';
        document.getElementById('clip2').value = selected.clips[1] || '';
        document.getElementById('clip3').value = selected.clips[2] || '';
      });

      streamerSelect.dispatchEvent(new Event('change')); // erstes Mal laden
    }

    document.getElementById('adminForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = streamerSelect.value;
      const clips = [
        document.getElementById('clip1').value,
        document.getElementById('clip2').value,
        document.getElementById('clip3').value,
      ];

      const res = await fetch('/.netlify/functions/update_config', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ twitchName: name, clips })
      });

      const status = document.getElementById('status');
      if (res.ok) {
        status.textContent = '✅ Erfolgreich gespeichert!';
      } else {
        const error = await res.text();
        status.textContent = `❌ Fehler: ${error}`;
      }
    });

    loadStreamerList();
  </script>
</body>
</html>
